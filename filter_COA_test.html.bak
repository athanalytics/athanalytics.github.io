<!DOCTYPE html>
<html>
<head>
  <title>COA Filter Test</title>
  <link rel="stylesheet" type="text/css" href="asset/master.css">
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
</head>
<body>
  <h1>Business Office: COA Filter Test</h1>
  
  <!-- Search Input -->
  <input type="text" id="myInput" onkeyup="filterData()" placeholder="Search for codes...">
  
  <!-- Table to Display Results -->
  <table id="myTable">
    <thead>
      <tr class="header">
        <th>Cost Center</th>
        <th>YD Code</th>
        <th>Program</th>
        <th>Project</th>
        <th>Spend Category</th>
        <th>Supplier</th>
        <th>Memo</th>
      </tr>
    </thead>
    <tbody id="myTableBody">
      <!-- Data rows will be inserted here -->
    </tbody>
  </table>
  
  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDVNwbw1tkMCu-qSKXyt3MZsvLPXJGBvR8",
      authDomain: "athanalytics-daa90.firebaseapp.com",
      projectId: "athanalytics-daa90",
      storageBucket: "athanalytics-daa90.appspot.com",
      messagingSenderId: "606022473336",
      appId: "1:606022473336:web:db54e91edc7901aa48ff8d",
      measurementId: "G-TP6D394Y1D"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    console.log("Firebase initialized");

    async function filterData() {
      const searchTerm = document.getElementById('myInput').value;
      console.log("Search term: ", searchTerm);
      try {
        const querySnapshot = await db.collection('filter_COA')
                                      .where('Cost.Center', '>=', searchTerm)
                                      .where('Cost.Center', '<=', searchTerm + '\uf8ff')
                                      .get();
        const data = querySnapshot.docs.map(doc => doc.data());
        console.log("Data fetched: ", data);
        renderData(data);
      } catch (error) {
        console.error("Error fetching data: ", error);
      }
    }

    function renderData(data) {
      console.log("Rendering data...");
      const tableBody = document.getElementById('myTableBody');
      tableBody.innerHTML = ''; // Clear previous results
      data.forEach(item => {
        const row = document.createElement('tr');
        row.innerHTML = `<td>${item['Cost.Center']}</td><td>${item['YD.Code']}</td><td>${item['Program']}</td><td>${item['Project']}</td><td>${item['Spend.Category']}</td><td>${item['Supplier']}</td><td>${item['Memo']}</td>`;
        tableBody.appendChild(row);
      });
      console.log("Data rendered");
    }
  </script>
</body>
</html>
